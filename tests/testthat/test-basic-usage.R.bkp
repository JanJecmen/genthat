
library(genthat)
library(testthat)

source("./utils.R")

context("Basic usage of genthat")

test_that("basic gen_from_code usage", {
    with_tempdir(function(dir) {
        dir.create("generated_tests")
        dir.create("traces")

        genthat_config(trace_dir = "traces")
        
        fn1 <- function(a, b) { a + b + 1 }
        fn1 <- decorate_function_val(fn1, "fn1_label")

        fn1(32, 81) 

        gen_tests(output_dir = "generated_tests")

        testfile <- file.path(dir, 'generated_tests', 'fn1_label', 'test-0.R')

        test_result1 <- run_test_file(testfile, list(
            fn1_label = function(a, b) { 1 + a + b }
        ))
        expect_equal(test_result1, TRUE)

        test_result2 <- run_test_file(testfile, list(
            fn1_label = function(a, b) { 2 + a + b }
        ))
        expect_equal(test_result2, FALSE)
    })
})

#test_that("basic gen_from_function usage", {
#    with_tempdir(function(dir) {
#        dir.create("generated_tests")
#        dir.create("traces")
#
#        example_package_path <- file.path(get_testthat_folder(), "example-package")
#        gen_result <- gen_from_function(example_package_path, function() { suppressMessages({ public_fn(32) }) }, output_dir = "generated_tests", trace_dir = "traces")
#
#        testfile <- file.path(dir, 'generated_tests', 'examplePackage___public_fn', 'test-0.R')
#        test_result1 <- run_test_file(testfile, list())
#        expect_equal(test_result1, TRUE)
#    })
#})

